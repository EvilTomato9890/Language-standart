## Формат хранения AST

AST хранится в текстовом виде в **рекурсивной** форме:

```
<node> (<left>) (<right>)
```

Пробелы **не важны**: их может не быть вообще или быть сколько угодно.

### Рекурсивность

`<left>` и `<right>` записываются **точно в том же формате**, что и корневой `<node>`.


### Пустые дети

Если ребёнка нет, на его месте пишутся **пустые скобки**:

- нет левого ребёнка:
  ```
  <node> () (<right>)
  ```

- нет правого ребёнка:
  ```
  <node> (<left>) ()
  ```

- нет обоих:
  ```
  <node> () ()
  ```

---

  

## Как записывается значение вершины

Значение `<node>` кодируется по типу вершины:

1. **Число (Number)**  

   Хранится в обычной форме или в форме с десятичной экспонентой:  
   `12`, `-3.5`, `1.2e3`, `-4E-2`.

2. **Оператор (Operator)**  

   Записывается строкой **без кавычек**:  
   `PLUS`, `MUL`, `IF`, `CALL` (или любые другие имена операторов из каталога).

3. **Идентификатор (Identifier)**  

   Записывается строкой **в кавычках**:  
   `"x"`, `"foo"`, `"my_var"`.
  
Список допустимых типов вершин и имён операторов смотри в:  

- [[Каталог операторов]]
  
---

>[!Tip] Примеры хранения небольших деревье
>```
>RETURN () (5 () ())
>```
>```
>PLUS (5 () ()) ("x" () ())
>```
>```
>FINISH () ()
>```

---
## Инварианты формата

- Узел-число **обязан** иметь детей `() ()`.

- Для пустых детей всегда используется именно `()`

- Любой символ/токен, который нельзя однозначно разобрать по правилам выше, считается ошибкой.

>[!fail] Ошибки парсера
>Парсер должен выдавать ошибку, если:
>- нарушена структура `(<left>) (<right>)`
>- встретился неизвестный оператор
>- идентификатор не в кавычках
>- число имеет детей, отличные от `() ()`
>- встречен мусорный символ, который не подходит ни под одно правило